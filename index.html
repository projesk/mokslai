<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IPS mokymosi testas</title>
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --card:#111827;      /* gray-900 */
      --muted:#94a3b8;     /* slate-400 */
      --text:#e5e7eb;      /* gray-200 */
      --accent:#22c55e;    /* green-500 */
      --danger:#ef4444;    /* red-500 */
      --primary:#3b82f6;   /* blue-500 */
      --border:#1f2937;    /* gray-800 */
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 80% -10%, #1f2937 0%, var(--bg) 50%) fixed;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      line-height:1.5;
    }
    .wrap{
      max-width: 920px;
      margin: 32px auto;
      padding: 0 16px 40px;
    }
    header{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin: 8px 0 20px;
    }
    h1{font-size: clamp(24px, 3vw, 36px); margin: 0 0 6px;}
    .sub{color:var(--muted); font-size:14px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid var(--border);
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 8px 40px rgba(0,0,0,.25);
    }
    .meta{
      display:flex; gap:8px; flex-wrap:wrap; margin-bottom: 8px;
    }
    .badge{
      font-size: 12px; color: #cbd5e1; background:#0b1220; border:1px solid var(--border);
      padding: 4px 8px; border-radius:999px;
    }
    .q{
      font-size: clamp(18px, 2.6vw, 22px);
      margin: 8px 0 14px;
    }
    .choices{display:grid; gap:10px; margin: 14px 0 6px;}
    label.choice{
      display:flex; gap:10px; align-items:flex-start;
      padding: 14px 14px;
      border:1px solid var(--border);
      border-radius: 12px;
      background:#0b1220;
      cursor:pointer;
      transition: transform .06s ease, border-color .12s ease;
      user-select:none;
    }
    label.choice:hover{ transform: translateY(-1px); border-color:#25324a; }
    .choice.correct{ border-color: rgba(34,197,94,.7); background: rgba(34,197,94,.08); }
    .choice.incorrect{ border-color: rgba(239,68,68,.7); background: rgba(239,68,68,.08); }
    .choice input{ margin-top:4px; }
    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;}
    button{
      appearance:none; border:1px solid transparent; border-radius:12px;
      padding: 12px 16px; font-weight:600; cursor:pointer;
      background: var(--primary); color:white;
      transition: transform .06s ease, opacity .15s ease, background .2s ease;
    }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    button.secondary{ background:#0b1220; border-color:var(--border); color:var(--text); }
    button.ghost{ background:transparent; border-color:var(--border); color:var(--muted); }
    button:hover{ transform: translateY(-1px); }
    .feedback{
      margin-top:14px; padding:14px; border-radius:12px;
      background: #0b1220; border:1px solid var(--border);
    }
    .feedback .ok{color: var(--accent); font-weight:700}
    .feedback .bad{color: var(--danger); font-weight:700}
    footer{
      margin-top: 20px; color: var(--muted); font-size: 12px; text-align:center;
    }
    .topbar{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .sep{opacity:.3}
    .counter{ font-size:12px; color:#cbd5e1; background:#0b1220; border:1px solid var(--border); padding:6px 8px; border-radius:8px;}
    .hidden{ display:none !important; }
    .source{font-size:12px; color:#9aa8bf; margin-top:10px}
    .source a{ color:#b3c5ff; text-decoration:none }
    .source a:hover{ text-decoration:underline }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>IPS mokymosi testas</h1>
        <div class="sub">Keli teisingi variantai galimi. Pasirink po kelis ir paspausk <b>Patvirtinti</b>. Po atsakymo spausk <b>Kitas klausimas</b>.</div>
      </div>
      <div class="topbar">
        <div class="counter"><span id="seen">0</span>/<span id="total">0</span> ats.</div>
        <span class="sep">•</span>
        <button id="restart" class="ghost">Perkrauti</button>
      </div>
    </header>

    <div class="card">
      <div class="meta"><span class="badge" id="tema">Tema</span><span class="badge" id="qid">#</span></div>
      <div class="q" id="klausimas">Klausimas...</div>
      <div class="choices" id="choices"></div>
      <div class="btns">
        <button id="check">Patvirtinti</button>
        <button id="next" class="secondary hidden">Kitas klausimas</button>
      </div>
      <div class="feedback hidden" id="feedback"></div>
      <div class="source" id="source"></div>
    </div>

    <footer>
      Parengta naudojimui GitHub Pages. Vienas failas – <code>index.html</code>.
    </footer>
  </div>

<script>
// ======= KLAUSIMŲ DUOMENYS =======
// Pastaba: šis rinkinys leidžia keliems atsakymams būti teisingiems (checkbox).
const QUESTIONS = [
  {"id":"S01","tema":"NEWS2 / ankstyvas blogėjimas","klausimas":"Pacientas turi NEWS2 = 5. Kokių veiksmų IPS turėtų imtis? (pasirinkite visus tinkamus)","pasirinkimai":["Padidinti stebėjimo dažnumą ir dokumentuoti rodiklius kas 1 val.","Nedelsiant aktyvuoti RRT/ITS","Pranešti gydytojui ir parengti SBAR pranešimą","Nekreipti dėmesio, nes 5 yra nedidelis balas"],"teisingi":[0,2],"feedback_short":"NEWS2 ≥5 reikalauja padidinto dėmesio ir gydytojo informavimo.","feedback_long":"NEWS2 ≥5 rodo vidutinį–aukštą riziką: IPS didina stebėjimo dažnį, informuoja gydytoją ir paruošia aiškų SBAR pranešimą. RRT aktyvacija paprastai rekomenduojama prie ≥7 arba pagal vietinį protokolą."},
  {"id":"S02","tema":"ABCDE / sąmonės sumažėjimas","klausimas":"Pacientas tampa mieguistas, kvėpavimas paviršutiniškas, GKS sumažėjo. Kokią veiksmų seką IPS atliktų pirmiausia? (pasirinkite visus tinkamus)","pasirinkimai":["A) Patikrinti oro takus (A) ir užtikrinti praeinamumą","B) B) Pradėti išsamią neurologinę apžiūrą ir laukti neurologijos konsultacijos","C) B) Įvertinti kvėpavimą ir duoti papildomą deguonį","D) E) Patikrinti skausmą"],"teisingi":[0,2],"feedback_short":"ABCDE esmė: oro takai ir kvėpavimas pirmiausia.","feedback_long":"Esant sąmonės sumažėjimui pirmiausia užtikrinti A (airway) — galimi intubacijos požymiai; tuomet B — kvėpavimo įvertinimas ir O₂ pagal poreikį. Neurologinė apžiūra svarbi, bet ne pirmoje vietoje, jei yra kvėpavimo problemų."},
  {"id":"S03","tema":"SBAR komunikacija","klausimas":"Kuri informacija privalo būti įtraukta į SBAR pranešimą apie staigų hemodinamikos blogėjimą? (pasirinkite visus tinkamus)","pasirinkimai":["S: trumpas situacijos aprašymas (pvz., „pacientas hypotenzija“) ","B: detali paciento istorija nuo gimimo","A: objektyvūs parametrai (AKS, pulsas, SpO₂, GKS)","R: konkreti rekomendacija (pvz., „prašau atvykti į palatą“)"],"teisingi":[0,2,3],"feedback_short":"SBAR turi būti trumpas, konkretus ir veikiantis.","feedback_long":"SBAR: Situation (kas vyksta), Background (trumpai reikšminga istorija), Assessment (objektyvūs parametrai), Recommendation (ką prašote). Venkite perteklinės informacijos."},
  {"id":"S04","tema":"Kvėpavimo nepakankamumas – hipoksemija vs hiperkapnija","klausimas":"Kuris požymis labiausiai rodo hiperkapninį kvėpavimo nepakankamumą? (pasirinkite visus tinkamus)","pasirinkimai":["Padidėjęs kvėpavimo darbas su tachipnėja","Reta kvėpavimas ir somnolencija","Aukštas PaCO₂ arterinėje kraujo dujose","Cianozė be kvėpavimo depresijos"],"teisingi":[1,2],"feedback_short":"Hiperkapnija dažnai sukelia kvėpavimo sulėtėjimą ir somnolenciją; PaCO₂ – diagnostinis.","feedback_long":"Hiperkapnija: sutrikęs kvėpavimas, sumažėjusi kvėpavimo galia, augantis PaCO₂ arterinėse dujose. Hipoksemija – žemos SpO₂ reikšmės. IPS remiasi klinika ir ABG."},
  {"id":"S05","tema":"Kvėpavimo terapija","klausimas":"Pacientas su SpO₂ 89% nepaisant 4 l/min kaniulės. Kurių veiksmų imtumėtės? (pasirinkite visus tinkamus)","pasirinkimai":["Pakeisti į kaukę su rezervuaru arba Venturi sistemą didesniam FiO₂","Pradėti HFNO arba NIV be gydytojo informavimo","Vertinti kvėpavimo darbą ir ABG","Ruoštis intubacijai, jei nepagerėja"],"teisingi":[0,2,3],"feedback_short":"Reikia eskaluoti deguonies tiekimą, įvertinti ABG ir pasiruošti invazinei ventiliacijai, jei nėra pagerėjimo.","feedback_long":"Nepakankama saturacija su standartine kaniule reikalauja didesnės FiO₂ metodo, ABG paėmimo ir gydytojo informavimo; jei HFNO/NIV neefektyvu — pasiruošti intubacijai."},
  {"id":"S06","tema":"ABG interpretacija","klausimas":"ABG rodikliai: pH 7.25, PaCO₂ 60 mmHg, HCO₃⁻ 26 mmol/L. Ką tai labiausiai sako? (pasirinkite visus tinkamus)","pasirinkimai":["Respiracinė acidozė su nekompensuotu HCO₃⁻","Metabolinė acidozė","Reikalinga kvėpavimo ventiliacijos peržiūra","Normalus ABG"],"teisingi":[0,2],"feedback_short":"Padidėjęs PaCO₂ ir žemas pH rodo respiracinę acidozę; reikia įvertinti ventilaciją.","feedback_long":"ABG: pH sumažėjęs, PaCO₂ aukštas — respiracinės acidozės požymis; HCO₃⁻ nėra pakilęs, todėl kompensacija ribota. IPS informuoja gydytoją dėl ventiliacijos korekcijos."},
  {"id":"S07","tema":"NIV efektyvumo vertinimas","klausimas":"Kaip IPS atpažįsta, kad NIV neveikia? (pasirinkite visus tinkamus)","pasirinkimai":["Pacientas lieka duslus, SpO₂ nemažėja arba krenta","ABG rodo didėjantį PaCO₂ arba negerėjantį pH","Pacientas jaučiasi patogiai ir kvėpavimas sumažėjęs","Atsiranda oro nutekėjimas pro kaukę"],"teisingi":[0,1],"feedback_short":"NIV nesėkmę rodo neišsaugota oksigenacija ar blogėjantys ABG.","feedback_long":"Vertinama klinika (dusulys, darbas, būsena) ir ABG. Jei PaCO₂ didėja arba SpO₂ nepagerėja, reikia greitos eskalacijos (ITV) ir gydytojo konsultacijos."},
  {"id":"S08","tema":"LOPL deguonies tikslai","klausimas":"Koks tikslinis SpO₂ intervalas daugeliui LOPL pacientų? (pasirinkite visus tinkamus)","pasirinkimai":["88–92%","95–100%","≥97%","80–85%"],"teisingi":[0],"feedback_short":"LOPL pacientams įprastai siekiama 88–92% SpO₂.","feedback_long":"Dėl CO₂ sulaikymo rizikos LOPL pacientams nerekomenduojamas aukštas deguonies tiekimas; tikslas dažniausiai 88–92% (priklauso nuo vietinių gairių)."},
  {"id":"S09","tema":"Šokas – atskyrimas","klausimas":"Pacientas su hipotenzija ir tachikardija: kuriuos požymius labiausiai siejate su hipovoleminiu (ne kardiogeniniu) šoku? (pasirinkite visus tinkamus)","pasirinkimai":["Šalta, blyški oda ir sumažėjusi diurezė","Plaučiuose krepitacija ir ortopnė","Pagerėjimas po IV skysčių boliaus","Padidėjęs JVP (jugular venous pressure)"],"teisingi":[0,2],"feedback_short":"Hipovolemijai būdinga blyški oda, mažas diurezė ir pagerėjimas gavus skysčių.","feedback_long":"Kardiogeninis šokas dažnai turi plaučių stazės požymių (krepitacija), padidėjusį JVP; hipovolemija dažniau atsako į skysčius. IPS įvertina kliniką ir stebi reakciją į terapiją."},
  {"id":"S10","tema":"Šokas – pirmieji veiksmai (ABCDE)","klausimas":"Įtarus šoką (AKS žemas, tachikardija) — kokie pirmieji IPS žingsniai pagal ABCDE? (pasirinkite visus tinkamus)","pasirinkimai":["A: užtikrinti oro takus","B: įvertinti kvėpavimą ir deguonį","C: pradėti IV prieigą, skirti skysčius pagal protokolą","D: atlikti pilną išsamų gydytojo egzaminą be stabilizacijos"],"teisingi":[0,1,2],"feedback_short":"ABCDE: A ir B saugo gyvybę; C — skysčiai ir infuzija yra būtini šoko valdymui.","feedback_long":"Šoko valdymas: užtikrinti A/B, tada greitai įvertinti C (IV prieiga, skysčių bolius) ir informuoti gydytoją/RRT. Stabilizacija turi prioritetą prieš išsamų tyrimą."},
  {"id":"S11","tema":"Skysčių atsakas","klausimas":"Po 500 ml kristaloidų boliaus AKS pakilo iš 75/45 iki 95/60, pulsas sumažėjo. Kaip interpretuojate? (pasirinkite visus tinkamus)","pasirinkimai":["Pacientas teigiamai reaguoja į skysčius","Reikia nedelsiant pradėti vazopresorių","Sekti tolesnį atsaką ir vertinti perfuziją","Nutraukti monitoravimą"],"teisingi":[0,2],"feedback_short":"Aukštėjanti AKS ir mažėjantis pulsas rodo teigiamą skysčių atsaką; reikia tolesnio stebėjimo.","feedback_long":"Jei po boliaus stabilizuojasi hemodinamika, tęsimas ir stebėjimas yra tinkamas; jei nepakankamas atsakas — apsvarstyti vazopresorius. IPs fiksuoja rezultatus."},
  {"id":"S12","tema":"Perfuzijos požymiai be invazinių metodų","klausimas":"Kuriuos neinvazinius požymius IPS gali naudoti audinių perfuzijos įvertinimui? (pasirinkite visus tinkamus)","pasirinkimai":["Širdies dažnis ir kraujospūdis","Kojų temperatūra ir odos spalva","Kraujospūdžio matavimas kas 24 valandas be kitų požymių","Diurezės kiekis"],"teisingi":[0,1,3],"feedback_short":"Perfuziją įvertiname hemodinamikos ir klinikiniais parametrais bei diureze.","feedback_long":"IPS vertina HR, BP, odos perfuziją (šaltumas, blyškumas), diurezę ir sąmonės lygį — visa tai rodo audinių perfuziją. Reguliarus stebėjimas svarbus."},
  {"id":"S13","tema":"Šoko ir delyro ryšys","klausimas":"Kodėl pacientui su šoku gali atsirasti delyras ir ką IPS darytų? (pasirinkite visus tinkamus)","pasirinkimai":["Dėl smegenų hipoperfuzijos ir hipoksijos — skubus perfuzijos gerinimas","Delyrą ignoruoti, nes tai nekliniškai svarbu","Užtikrinti saugumą, pašalinti dirgiklius (skirti akustinę ramybę, orientavimo priemones)","Pradėti antipsichotikus be gydytojo sutikimo"],"teisingi":[0,2],"feedback_short":"Delyras gali kilti dėl hipoperfuzijos; pirmiausia geriname perfuziją ir saugumą.","feedback_long":"IPS apsaugo pacientą, užtikrina perfuziją, mažina dirgiklius, koordinuoja su gydytoju delyro gydymui. Farmakologija turi būti gydytojo inicijuota."},
  {"id":"S14","tema":"Ūminis širdies nepakankamumas","klausimas":"Kokie požymiai labiau rodo stazinį (kardiogeninį) širdies nepakankamumą, o ne hipovolemiją? (pasirinkite visus tinkamus)","pasirinkimai":["Plaučių krepitacija / rales","Padidėjęs JVP","Pagerėjimas po didelio IV skysčių boliaus","Šalta, blyški oda be plaučių simptomų"],"teisingi":[0,1],"feedback_short":"Plaučių krepitacija ir padidėjęs JVP labiau rodo kardiogeninį sutrikimą.","feedback_long":"Kardiogeninis šokas dažnai turi stazinius plaučių požymius ir padidintą JVP; hipovolemija dažniau atsako į skysčius ir neturi plaučių stazės požymių."},
  {"id":"S15","tema":"Pooperacinis kraujavimas","klausimas":"Kokie klinikiniai parametrai rodo, kad pooperacinis kraujavimas tampa kritinis? (pasirinkite visus tinkamus)","pasirinkimai":["Sparčiai krentantis AKS ir augantis pulsas","Sumenkęs sąmonės lygis arba šaltas prakaitas","Stabilus hemoglobinas per kelias valandas","Didelis drenavimo tūris per trumpą laiką"],"teisingi":[0,1,3],"feedback_short":"Kritinis kraujavimas – hemodinaminė instabilumas, sumažėjusi sąmonė ir didelis drenavimas.","feedback_long":"IPS veikia greitai: skelbti RRT, pradėti IV skysčius, pranešti chirurgui, gauti kryžminį kraują ir paruošti transfuziją pagal vietinį protokolą."},
  {"id":"S16","tema":"Delyras – ankstyvas atpažinimas","klausimas":"Kuris požymis labiausiai atitinka ankstyvą delyro stadiją? (pasirinkite visus tinkamus)","pasirinkimai":["Stiprus miego budrumo sutrikimas ir naktinis neramumas","Gilus koma būsenos kritimas","Perceptualinės klaidos (pvz., halucinacijos) ir dezorientacija","Ilgalaikė stabilizuota sąmonė"],"teisingi":[0,2],"feedback_short":"Ankstyvas delyras dažnai prasideda dienos–nakties ritmo sutrikimais, dezorientacija ir halucinacijomis.","feedback_long":"IPS stebi miego–budrumo pokyčius, orientaciją, komunikaciją; nefarmakologiniai veiksmai pirmiausia (orientavimo priemonės, šviesos reguliavimas) ir gydytojo informavimas."},
  {"id":"S17","tema":"RASS ir sedacija","klausimas":"Pacientas su RASS -3. Ką tai reiškia ir kokie yra IPS veiksmai? (pasirinkite visus tinkamus)","pasirinkimai":["Reikš 'storingą sedaciją' — reaguoja į garsą, bet ne į švelnų kontaktą","Nereikia korekcijų, jei pacientas ventiliuojamas planuotai","Peržiūrėti sedaciją ir informuoti gydytoją, jei neplanuota","Pradėti skubią intubaciją"],"teisingi":[0,2],"feedback_short":"RASS -3 rodo gilų sedaciją; reikia peržiūros, jei neplanuota.","feedback_long":"RASS interpretacija svarbi sedacijos valdymui. IPS įvertina kontekstą (planinė sedacija ar ne) ir praneša gydytojui, jei korekcija būtina. Nekviesti intubacijos tik dėl RASS, jei nėra kvėpavimo problemų."},
  {"id":"S18","tema":"Skausmo vertinimas nekomunikuojantiems","klausimas":"Kuris metodas tinka skausmo vertinimui intubuotam/nekomunikuojančiam pacientui? (pasirinkite visus tinkamus)","pasirinkimai":["Naudoti CPOT arba PAINAD skalę","Spėti pagal veido išraišką ir judesius","Nereikia vertinti skausmo, nes pacientas negali kalbėti","Derinti elgsenos požymius su fiziologiniais parametrais"],"teisingi":[0,1,3],"feedback_short":"Naudokite validuotas elgesio skales ir derinkite jas su fiziologiniais duomenimis.","feedback_long":"CPOT/PAINAD leidžia įvertinti intubuotų pacientų skausmą; IPS fiksuoja rodiklius ir informuoja komandą dėl analgezijos korekcijos."},
  {"id":"S19","tema":"Skausmo valdymas pooperacine","klausimas":"Pacientas VAS 8/10 po operacijos. Kurių veiksmų turėtų imtis IPS? (pasirinkite visus tinkamus)","pasirinkimai":["Pranešti gydytojui ir siūlyti analgeziją (opioidai arba PCA pagal protokolą)","Duoti tik paracetamolį ir palikti be radikalesnių veiksmų","Vertinti RASS ir kvėpavimo funkciją po analgezijos","Stebėti skausmą kas 30–60 min po intervencijos"],"teisingi":[0,2,3],"feedback_short":"Stiprus skausmas reikalauja gydytojo įsikišimo ir saugaus analgezijos planavimo.","feedback_long":"IPS informuoja gydytoją, stebi kvėpavimą po opioido skyrimo, fiksuoja rezultatą ir laiko intervalus. Paracetamolis gali būti papildomas, bet paprastai nepakanka VAS 8."},
  {"id":"S20","tema":"Mityba ir skysčių balansas","klausimas":"Po didelės operacijos pacientui įvesta 3000 ml per 24 val. ir diurezė 800 ml. Koks skysčių balansas ir ką reikėtų apsvarstyti? (pasirinkite visus tinkamus)","pasirinkimai":["Balansas yra +2200 ml — reikalinga tolesnė stebėsena","Balansas yra -2200 ml","Įvertinti klinikinius požymius (edema, plaučių krepitacija) prieš sprendžiant toliau","Nedelsiant nutraukti skysčius nepriklausomai nuo būklės"],"teisingi":[0,2],"feedback_short":"Skysčių perteklius/deficitas įvertinamas kiekybiškai ir klinikiniu kontekstu.","feedback_long":"Pozityvus balansas gali reikšti perkrovą, bet sprendimus reikia pagrįsti klinikiniais požymiais — edema, plaučių auskultacija, diurezė ir hemodinamika. IPS praneša gydytojui."},
  {"id":"S21","tema":"Inkstų funkcija – AKI požymiai","klausimas":"Kuris derinys labiausiai rodo ūminį inkstų pažeidimą (AKI)? (pasirinkite visus tinkamus)","pasirinkimai":["Staigus kreatinino padidėjimas per 48 val.","Diurezė <0.5 ml/kg/h kelias valandas","Ilgalaikis mikroalbuminurija be ūmaus pokyčio","Normalus kreatininas ir normalus diurezė"],"teisingi":[0,1],"feedback_short":"AKI diagnozuojamas pagal staigų kreatinino padidėjimą arba sumažėjusią diurezę.","feedback_long":"IPS fiksuoja diurezę kas valandą, informuoja gydytoją apie kreatinino pokyčius ir koreguoja vaistus bei skysčių planą."},
  {"id":"S22","tema":"Sepsis – įtarimas","klausimas":"Pacientas pooperacinis su karščiavimu 38.9°C, laktatas 3.2 mmol/L, AKS 92/56. Ką IPS pirmiausia turi atlikti? (pasirinkite visus tinkamus)","pasirinkimai":["Paimti kraujo kultūras prieš antibiotikus","Pradėti plataus spektro antibiotikus nedelsiant","Palaukti 24 val. prieš imantis veiksmų","Vertinti likusius NEWS2 ir pranešti gydytojui"],"teisingi":[0,1,3],"feedback_short":"Sepsio 1 valandos bundle: kultūros prieš antibiotikus, antibiotikai nedelsiant, vertinimas ir informavimas.","feedback_long":"IPS užtikrina, kad kultūros paimtos prieš AB, inicijuojami AB <1 val., stebimas laktatas ir hemodinamika; informuoja gydytoją/RRT."},
  {"id":"S23","tema":"Sepsis – laktatas","klausimas":"Ką reiškia laktato padidėjimas ≥2 mmol/L sepsio kontekste? (pasirinkite visus tinkamus)","pasirinkimai":["Audinių hipoperfuzijos požymis","Visada reiškia, kad pacientas yra mirštantis","Reikia monitoruoti ir kartoti laktatą po terapijos","Nereikšmingas klinikinis rodiklis"],"teisingi":[0,2],"feedback_short":"Padidėjęs laktatas rodo audinių hipoperfuziją; reikia monitoringo ir kartojimo.","feedback_long":"Laktatas ≥2 mmol/L kartu su įtariama infekcija yra sepsio požymis; IPS stebi laktatą ir praneša apie pokyčius gydytojui."},
  {"id":"S24","tema":"Sepsis – skysčių terapija","klausimas":"Pacientui su sepsiu ir hipotenzija, koks pradinis IV skysčių kiekis pagal dažniausius protokolus? (pasirinkite visus tinkamus)","pasirinkimai":["30 ml/kg kristaloidų bolius per pirmą valandą (priklausomai nuo vietinių gairių)","10 ml/kg per parą","Niekada neskirti skysčių sepsio atveju","Skysčiai tik jei AKS <50"],"teisingi":[0],"feedback_short":"Pradinis rekomenduojamas kiekis dažniausiai ~30 ml/kg kristaloidų per pirmą valandą.","feedback_long":"Tai bendros gairės; reikalingas individualus vertinimas (kardiologinis statusas, plaučių edema). IPS ruošia IV prieigą ir dokumentuoja skysčių duodamą kiekį."},
  {"id":"S25","tema":"Sepsis – antibiotikų pradžia","klausimas":"Kodėl svarbu paimti kultūras prieš antibiotikų skyrimą? (pasirinkite visus tinkamus)","pasirinkimai":["Kad būtų galima vėliau tiksliai pritaikyti antibiotikų spektrą","Kad antibiotikai būtų neefektyvūs","Kad būtų sumažintas vėlavimo rizika pradiniame gydyme","Tam, kad niekada neskirti antibiotikų"],"teisingi":[0,2],"feedback_short":"Kultūros prieš AB leidžia vėliau tiksliai pakeisti antibiotiką; tačiau AB turi būti pradėti nedelsiant.","feedback_long":"Paimtos kultūros padeda tikslinti gydymą pagal atsparumus; bet vėlavimas skirti AB padidina mirties riziką, todėl kultūros daromos greitai prieš pirminį AB."},
  {"id":"S26","tema":"NEWS2 – kada kviesti RRT","klausimas":"Koks NEWS2 intervalas paprastai sukelia skubią reakciją ir RRT iškvietimą? (pasirinkite visus tinkamus)","pasirinkimai":["NEWS2 ≥7","NEWS2 0–2","NEWS2 5–6 (priklausomai nuo klinikinio vaizdo)","NEWS2 = 1"],"teisingi":[0,2],"feedback_short":"NEWS2 ≥7 reikia skubios reakcijos; 5–6 gali reikšti padidintą priežiūrą ir gydytojo įsikišimą.","feedback_long":"Vietiniai protokolai gali skirtis; tačiau dažniausiai ≥7 reiškia RRT kvietimą, o 5–6 — intensyvesnį stebėjimą ir diskusiją su gydytoju."},
  {"id":"S27","tema":"Komandos vaidmenys kritinėje situacijoje","klausimas":"Kokią (IPS) atsakomybę turėtų prisiimti slaugytoja kritinėje situacijoje prieš atvykstant gydytojui? (pasirinkite visus tinkamus)","pasirinkimai":["Pradėti ABCDE stabilizaciją","Nedelsiant pakeisti gydymo planą be komandos žinojimo","Užtikrinti IV prieigą ir reikalingus prietaisus","Kviesti papildomą pagalbą ir informuoti komandą"],"teisingi":[0,2,3],"feedback_short":"IPS pradeda stabilizaciją, užtikrina prieigą ir informuoja komandą bei kitiems nariams paskirsto užduotis.","feedback_long":"Slaugytoja negali pakeisti gydymo plano nepranešus, tačiau ji aktyviai stabilizuoja pacientą, paruošia reikalingus resursus ir koordinuoja komandą."},
  {"id":"S28","tema":"Etinės dilemos","klausimas":"Kaip IPS turėtų elgtis, kai šeima atsisako siūlomo gydymo kritinėje situacijoje? (pasirinkite visus tinkamus)","pasirinkimai":["Gerbti bet kokį šeimos sprendimą be jokio bandymo paaiškinti","Kalbėtis aiškiai, pateikti informaciją, naudoti aiškius variantus ir pranešti gydytojui/etikos komandai","Užfiksuoti šeimos pageidavimus dokumentacijoje","Imtis gydymo prieš šeimos valią be teisinio pagrindo"],"teisingi":[1,2],"feedback_short":"IPS informuoja, aiškiai diskutuoja ir įtraukia gydytoją/etikos komandą; dokumentuoja sprendimą.","feedback_long":"Etinės dilemos reikalauja skaidraus bendravimo, šeimos įtraukimo ir teisinių / etinių konsultacijų; IPS neužleidžia dokumentavimo."},
  {"id":"S29","tema":"Refleksija po incidento","klausimas":"Kokie veiksmai padeda IPS reflektuoti po kritinio incidento? (pasirinkite visus tinkamus)","pasirinkimai":["Dalintis patirtimi per debriefing su komanda","Ignoruoti įvykį ir grįžti prie darbo","Dalyvauti mokymuose ar peržiūrose (auditai, simuliacijos)","Dokumentuoti veiksmus ir pasiūlymus tobulinti"],"teisingi":[0,2,3],"feedback_short":"Debriefingas, mokymai ir dokumentacija padeda mokymuisi ir emociniam atsistatymui.","feedback_long":"Refleksija po incidento turi būti struktūruota: komandinė diskusija, identifikavimas kas veikė ir ką tobulinti, bei emocinis palaikymas."},
  {"id":"S30","tema":"Temperatūros svyravimai","klausimas":"Pooperacinis subfebrilus karščiavimas (37.5–38.0°C) 2–3 dieną dažniausiai reiškia: (pasirinkite visus tinkamus)","pasirinkimai":["Fleksinę reakciją į chirurginį traumos poveikį","Bakterinę infekciją (visada)","Vėsentinę echoskopijos klaidą","Reikalingą stebėjimą ir klinikinį įvertinimą (ne visada AB)"],"teisingi":[0,3],"feedback_short":"Subfebrilus karščiavimas gali būti pooperacinis uždegiminis atsakas, bet reikia įvertinti priežastis.","feedback_long":"IPS vertina kliniką, apžiūrą, laboratorinius rodiklius ir tikslina veiksmus; nebūtina iš karto pradėti AB be aiškių požymių."},
  {"id":"S31","tema":"Neurologiniai sutrikimai","klausimas":"Pacientas staiga praranda orientaciją ar sąmonę. Kuriuos veiksmus IPS atliks pirmiausia? (pasirinkite visus tinkamus)","pasirinkimai":["ABCDE įvertinimas (ypač A ir B)","Imobilizuoti galvą ir pritarti neurologinei diagnostikai, jei įtariamas trauminis poveikis","Ignoruoti, nes tai greitai praeis","Paimti gliukozės matavimą ir gydyti, jei hipoglikemija"],"teisingi":[0,1,3],"feedback_short":"ABCDE ir greitas gliukozės tikrinimas yra pirmieji žingsniai; imobilizacija reikalinga jei įtariamas trauminis poveikis.","feedback_long":"Staigus sąmonės praradimas reikalauja greitos ABCDE stabilizacijos, gliukozės patikros, neuro stebėjimo ir greitos komunikacijos su gydytoju."},
  {"id":"S32","tema":"Ūminis kvėpavimo sustojimas","klausimas":"Pacientas nustojo kvėpuoti. Kokių veiksmų IPS turi imtis iki gaivinimo komandos atvykimo? (pasirinkite visus tinkamus)","pasirinkimai":["Nedelsiant pradėti krūtinės kompresijas, jei nėra pulso","Užtikrinti oro takus ir pradėti dirbtinį kvėpavimą (jei apmokyta)","Ieškoti papildomos informacijos apie paciento gyvybinius požymius tik per dokumentaciją","Kviesti pagalbą ir naudoti defibriliatorių, jei prieinamas ir indikacija"],"teisingi":[0,1,3],"feedback_short":"Pradėti BLS — kompresijos, užtikrinti O2, kviesti pagalbą ir AED jei reikalinga.","feedback_long":"IPS atlieka BLS: greita gaivinimo pradžia gerina išlikimo galimybes; AED naudojimas kai rodomas širdies ritmas, tinkamas defibriliacijai."},
  {"id":"S33","tema":"Paciento pozicionavimas kvėpavimui","klausimas":"Kuri pozicija dažnai palengvina kvėpavimą ar hipoksinį pacientą? (pasirinkite visus tinkamus)","pasirinkimai":["Pusiau sėdima (45 laipsnių)","Gulėjimas ant nugaros su pagalvėmis po galva","Cinkuojamas stovėjimas","Sėdima pozicija su palaikymu"],"teisingi":[0,3],"feedback_short":"Pusiau sėdima arba sėdima pozicija paprastai mažina diafragmos apkrovą ir palengvina kvėpavimą.","feedback_long":"Pozicija turi įtakos kvėpavimo darbui; IPS padeda pacientui sėdėti, užtikrina saugumą ir stebi SpO₂."},
  {"id":"S34","tema":"Pagalbos iškvietimas","klausimas":"Kada IPS turi kviesti RRT arba gydytoją skubiai? (pasirinkite visus tinkamus)","pasirinkimai":["Staigus ir reikšmingas NEWS2 padidėjimas (≥7)","Nenumaldomas kraujavimas ar hemodinaminė instabilumas","Tik keli nedideli nepastovūs simptoma be kitų požymių","Kvėpavimo sustojimas arba sąmonės praradimas"],"teisingi":[0,1,3],"feedback_short":"RRT kviesti esant hemodinaminei instabilumui, kvėpavimo ar sąmonės praradimui arba NEWS2 labai aukštam.","feedback_long":"Greitas RRT kvietimas gali išgelbėti gyvybę; IPS turi žinoti vietinius kriterijus ir būti pasiruošusiems veikti."},
  {"id":"S35","tema":"Kateterio priežiūra","klausimas":"Kokie IPS veiksmai reikalingi šlapimo kateterio priežiūrai siekiant sumažinti infekcijų riziką? (pasirinkite visus tinkamus)","pasirinkimai":["Kasdien vertinti poreikį ir pašalinti, jei nebūtinas","Užtikrinti aseptiką priežiūros metu ir tinkamą laidų tvirtinimą","Keisti kateterį kas 24 valandas profilaktiškai","Fiksuoti įrašus apie kiekvieną manipuliaciją"],"teisingi":[0,1,3],"feedback_short":"Kasdienė poreikio vertinimas, aseptika ir dokumentacija mažina CAUTI riziką.","feedback_long":"Kateterio atsargumas, tvarkinga priežiūra ir ankstyvas pašalinimas yra pagrindinės prevencinės priemonės; profilaktinis keitimas kas 24 h nėra rekomenduojamas."},
  {"id":"S36","tema":"Pragulos prevencija","klausimas":"Kuris veiksmų derinys tinka pragulų prevencijai sėdinčiam/slaugomam pacientui? (pasirinkite visus tinkamus)","pasirinkimai":["Keisti poziciją kas 2 valandas","Naudoti slėgio mažinančias pagalves / čiužinius, jei sąlygos reikalauja","Leisti ilgai sėdėti be judėjimo","Apmokyti šeimą apie pozicijų keitimą ir odos stebėjimą"],"teisingi":[0,1,3],"feedback_short":"Reguliarus pozicijų keitimas, pagalvių/čiužinių naudojimas ir šeimos įtraukimas yra svarbūs.","feedback_long":"Prevenciniai veiksmai apima odos patikrinimą, mitybos vertinimą ir pozicijų keitimą; IPS koordinuoja planą su komanda."},
  {"id":"S37","tema":"Vazopresoriai – IPS elgesys","klausimas":"Kokius veiksmus IPS atlieka prižiūrint pacientą, gaunantį norepinefriną? (pasirinkite visus tinkamus)","pasirinkimai":["Stebėti invazinį arba neinvazinį AKS dažnai (pagal protokolą)","Reguliariai tikrinti perfuzijos požymius (diurezė, odos spalva)","Savavališkai didinti dozę be gydytojo sutikimo","Užtikrinti stabilumą IV prieigos ir infuzijų aparato"],"teisingi":[0,1,3],"feedback_short":"IPS stebi hemodinamiką, perfuziją ir infuzijų aparatą; dozės keitimus atlieka tik gydytojas.","feedback_long":"Vazopresorių priežiūra reikalauja nuolatinio parametrų įrašymo, periferinės prieigos patikros ir greito pranešimo apie komplikacijas."},
  {"id":"S38","tema":"Antimykrobinė stewardhip","klausimas":"Kokios IPS veiklos padeda gerinti antibiotikų naudojimą skyriuje? (pasirinkite visus tinkamus)","pasirinkimai":["Paimti kultūras prieš AB pradžią","Stebėti AB terapijos trukmę ir dokumentuoti indikaciją","Pradėti AB be dokumentacijos apie indikaciją","Informuoti komandą apie mikrobiologijos rezultatus"],"teisingi":[0,1,3],"feedback_short":"Kultūros prieš AB, dokumentavimas ir rezultatų stebėjimas padeda atsakingam AB naudojimui.","feedback_long":"IPS vaidina svarbų vaidmenį užtikrinant tinkamą AB pradžią ir peržiūrą pagal mikrobiologinius rezultatus."},
  {"id":"S39","tema":"Komunikacija su šeima","klausimas":"Kaip IPS turi informuoti šeimą apie paciento būklę kritinio pablogėjimo atveju? (pasirinkite visus tinkamus)","pasirinkimai":["Aiškiai paaiškinti dabartinę situaciją naudojant paprastą kalbą","Paslėpti blogą informaciją, kad nepertrauktų šeimos","Pateikti galimus veiksmus ir tolesnius žingsnius","Užtikrinti emocinį palaikymą ir informuoti apie prieinamą paramą"],"teisingi":[0,2,3],"feedback_short":"Atvira, empatiška ir informatyvi komunikacija yra būtina šeimai.","feedback_long":"IPS teikia suprantamą informaciją, aptaria galimus veiksmus ir nukreipia šeimą į papildomą paramą. Slaugytoja dokumentuoja pokalbį."},
  {"id":"S40","tema":"Paciento saugumas – prevencijos priemonės","klausimas":"Kokios prevencinės priemonės padeda išvengti kritinių incidentų (pvz., klaidingos infuzijos)? (pasirinkite visus tinkamus)","pasirinkimai":["Dviejų asmenų patvirtinimas prieš skiriant pavojingus medikamentus","Tiksli infuzijų etiketė ir check-list naudojimas","Palikti infuzijas be etikečių ir viltis, kad bus atpažinta","Reguliari inventorizacija ir mokymai"],"teisingi":[0,1,3],"feedback_short":"Check-list'ai, etiketės ir dviguba patikra mažina klaidų riziką.","feedback_long":"Sisteminės priemonės, mokymai ir darbo procesai yra pagrindas saugumo kultūrai. IPS aktyviai dalyvauja jų taikyme."},
  {"id":"S41","tema":"Mityba – paruošimas išrašymui","klausimas":"Ką IPS turi padaryti planuojant mitybos tęstinumą išrašant pacientą po ITS? (pasirinkite visus tinkamus)","pasirinkimai":["Įvertinti mitybos būklę ir sudaryti mitybos planą","Palikti mitybą be plano ir tikėtis, kad šeima pasirūpins","Konsultuoti dietologą ar reabilitologą jei reikia","Dokumentuoti mitybos rekomendacijas ir planuoti kontrolinius vizitus"],"teisingi":[0,2,3],"feedback_short":"Išrašant reikia įvertinti mitybą, planuoti tolesnę priežiūrą ir dokumentuoti rekomendacijas.","feedback_long":"IPS koordinates mitybos planą su komanda, įtraukia dietologą ir informuoja šeimą apie tolimesnę priežiūrą."},
  {"id":"S42","tema":"Sekimas po trapios intervencijos","klausimas":"Kokius parametrus IPS stebi artimiausias 4–6 val. po didelės operacijos? (pasirinkite visus tinkamus)","pasirinkimai":["Gyvybinius rodiklius (AKS, pulsas, RR, SpO₂)","Kraujavimo požymius (drenažo tūris, hematomas išvaizda)","Tik bendrą paciento nuotaiką be kitų parametrų","Skysčių balansą ir diurezę"],"teisingi":[0,1,3],"feedback_short":"Po didelės operacijos stebimi gyvybiniai rodikliai, kraujavimas ir skysčių balansas.","feedback_long":"Intensyvus stebėjimas pirmosiomis valandomis leidžia anksti atpažinti komplikacijas; IPS dokumentuoja visus duomenis."},
  {"id":"S43","tema":"Mobilizacija ir reabilitacija","klausimas":"Kada IPS pradeda pažangius mobilizacijos veiksmus po stabilizacijos? (pasirinkite visus tinkamus)","pasirinkimai":["Kai paciento hemodinamika stabili ir gydytojas leidžia","Prieš išaiškinus pagrindines komplikacijas","Įtraukiant fizioterapeutą į planavimą","Visada – net jeigu paciento būklė nestabili"],"teisingi":[0,2],"feedback_short":"Mobilizacija prasideda tik esant stabiliai hemodinamikai ir dažnai kartu su fizioterapeutu.","feedback_long":"IPS koordinuoja mobilizaciją su gydytoju ir reabilitologu, atsižvelgia į skausmą, širdies funkciją ir kvėpavimą."},
  {"id":"S44","tema":"Infuzijų saugumas","klausimas":"Kokios yra geros praktikos taisyklės infuzijų aparatų naudojimui? (pasirinkite visus tinkamus)","pasirinkimai":["Reguliariai tikrinti aparato veikimą ir budrumo signalus","Naudoti etiketes su paciento ID ir vaisto pavadinimu","Palikti aparatą be tikrinimo ir pasitikėti automatika","Užtikrinti, kad infuzijų linijos tinkamai pritvirtintos"],"teisingi":[0,1,3],"feedback_short":"Reguliarus patikrinimas, etiketės ir teisingas tvirtinimas užtikrina infuzijų saugumą.","feedback_long":"IPS turi periodiškai tikrinti infuzijų prietaisus, reaguoti į signalus ir dokumentuoti bet kokius sutrikimus."},
  {"id":"S45","tema":"Komunikacija dokumentacijoje","klausimas":"Kokią informaciją IPS turi įrašyti dokumentacijoje po kritinės intervencijos? (pasirinkite visus tinkamus)","pasirinkimai":["Atliktų veiksmų laikas ir aprašymas","Paciento sutartis ar sutikimas prieš intervenciją","Rezultatai po intervencijos (AKS, SpO₂, reakcija)","Nereikia dokumentuoti, jei viskas gerai"],"teisingi":[0,2],"feedback_short":"Svarbu dokumentuoti veiksmus, laikus ir rezultatą; tai lemia gydymo tęstinumą.","feedback_long":"Tikslūs laiko žymenys ir veiksmų aprašymas leidžia komandai sekti paciento eigą ir audituoti įvykius vėliau."},
  {"id":"S46","tema":"Medicinos pagalbos prioritetai","klausimas":"Kuri informacija turi būti prioritetinė perduodama per perdavimą (handover)? (pasirinkite visus tinkamus)","pasirinkimai":["Saugumo rizikos (pvz., kritimo rizika, alergijos)","Esminės akutalios problemos ir vykstantys gydymo žingsniai","Detali asmeninė šeimos istorija be reikšmės dabartinei priežiūrai","Svarbūs laboratoriniai rodikliai ir IV prieigos"],"teisingi":[0,1,3],"feedback_short":"Handover turi apimti saugumo rizikas, aktyvias problemas ir kritinius duomenis.","feedback_long":"Struktūruotas perdavimas sumažina klaidų riziką ir užtikrina sklandžią paciento priežiūrą."},
  {"id":"S47","tema":"Paciento izoliacija ir infekcijų kontrolė","klausimas":"Kada reikia taikyti kontaktinę ar oro izoliaciją ir ką IPS turi daryti? (pasirinkite visus tinkamus)","pasirinkimai":["Kai yra žinoma ar įtariama užkrečiama infekcija reikalaujanti tokių priemonių","Tinkamai naudoti asmenines apsaugos priemones (AAP)","Niekada izoliacija nereikalinga","Riboti lankymus ir informuoti mikrobiologiją"],"teisingi":[0,1,3],"feedback_short":"Izoliacija ir AAP naudojimas yra būtini įtariant užkrečiamą infekciją.","feedback_long":"IPS užtikrina, kad personalas ir lankytojai laikytųsi izoliacijos taisyklių ir praneša atsakingiems skyriams."},
  {"id":"S48","tema":"Atsargumo priemonės prieš intubaciją","klausimas":"Kokius pasiruošimo žingsnius IPS turi užtikrinti prieš planuotą intubaciją? (pasirinkite visus tinkamus)","pasirinkimai":["Parengti reikalingą įrangą (laryngoscope, ET tube, BVM)","Užtikrinti O₂ tiekimą ir monitorius","Atlikti pilną chirurginę dokumentaciją po intubacijos vietoje","Paskambinti šeimai prieš kiekvieną intubaciją"],"teisingi":[0,1],"feedback_short":"Paruošimas įrangos ir monitorių yra privalomas; komunikacija su šeima – pagal situaciją.","feedback_long":"IPS turi pilnai paruošti priemones ir budėti per intubaciją, užtikrinti O₂/ventiliatorių paruošimą ir turėti rezervinį planą sunkiai intubuojamam pacientui."},
  {"id":"S49","tema":"Atsakomybės ribos slaugytojos","klausimas":"Kokios yra pagrindinės IPS atsakomybės ribos kritinėje situacijoje? (pasirinkite visus tinkamus)","pasirinkimai":["Atlikti stabilizacijos veiksmus pagal ABCDE","Savavališkai nustatyti diagnozę ir skirtį gydymą be komandos","Informuoti gydytoją ir dokumentuoti veiksmus","Užtikrinti paciento saugumą ir sklandų perdavimą"],"teisingi":[0,2,3],"feedback_short":"IPS stabilizuoja, informuoja gydytoją ir dokumentuoja; diagnozės nustatymas – gydytojo atsakomybė.","feedback_long":"Slaugytoja veikia pagal protokolus ir bendradarbiauja su gydytoju; ji turi žinoti savo veiksmų ribas ir suteikti tikslią informaciją komandai."},
  {"id":"S50","tema":"Refleksija ir emocinė parama","klausimas":"Kokios priemonės padeda IPS emociniam atsistatymui po sunkios situacijos? (pasirinkite visus tinkamus)","pasirinkimai":["Debriefing su komanda ir emocinė parama","Atskirta individuali refleksija ir profesionali pagalba, jei reikia","Ignoruoti jausmus ir dirbti toliau be pertraukos","Prašyti administracijos organizuoti mokymus arba pakeisti protokolus, jei paaiškėja spragos"],"teisingi":[0,1,3],"feedback_short":"Debriefingas, individuali refleksija ir organizacinė parama padeda emociniam atsistatymui.","feedback_long":"Aiški komandinė refleksija, prieiga prie psichologinės pagalbos ir mokymai prisideda prie ilgalaikio profesinio sveikatingumo."}
];

// ======= BŪSENA =======
let seen = new Set();
let current = null;

// ======= LOGIKA =======
const elTema = document.getElementById('tema');
const elQid = document.getElementById('qid');
const elKlausimas = document.getElementById('klausimas');
const elChoices = document.getElementById('choices');
const elFeedback = document.getElementById('feedback');
const elCheck = document.getElementById('check');
const elNext = document.getElementById('next');
const elSeen = document.getElementById('seen');
const elTotal = document.getElementById('total');
const elRestart = document.getElementById('restart');
const elSource = document.getElementById('source');

elTotal.textContent = QUESTIONS.length;

function pickRandomQuestion(){
  if(seen.size === QUESTIONS.length){
    return null;
  }
  let idx;
  do { idx = Math.floor(Math.random() * QUESTIONS.length); }
  while(seen.has(idx));
  seen.add(idx);
  elSeen.textContent = seen.size;
  return QUESTIONS[idx];
}

function renderQuestion(q){
  current = q;
  elTema.textContent = q.tema || 'Tema';
  elQid.textContent = q.id || '#';
  elKlausimas.textContent = q.klausimas;
  elChoices.innerHTML = '';
  elFeedback.classList.add('hidden');
  elFeedback.innerHTML = '';
  elNext.classList.add('hidden');
  elCheck.disabled = false;
  elSource.innerHTML = '';

  q.pasirinkimai.forEach((text, i)=>{
    const id = `opt_${i}`;
    const wrap = document.createElement('label');
    wrap.className = 'choice';
    wrap.setAttribute('data-index', i.toString());
    const input = document.createElement('input');
    input.type = 'checkbox';
    input.id = id;
    input.value = i.toString();
    const span = document.createElement('span');
    span.textContent = text;
    wrap.appendChild(input);
    wrap.appendChild(span);
    elChoices.appendChild(wrap);
  });
}

function arraysEqual(a,b){
  if(a.length !== b.length) return false;
  const sa = [...a].sort((x,y)=>x-y);
  const sb = [...b].sort((x,y)=>x-y);
  for(let i=0;i<sa.length;i++){ if(sa[i]!==sb[i]) return false; }
  return true;
}

function checkAnswer(){
  if(!current) return;
  const chosen = Array.from(elChoices.querySelectorAll('input[type=checkbox]'))
    .filter(i=>i.checked).map(i=>parseInt(i.value,10));
  const correct = current.teisingi || [];
  const ok = arraysEqual(chosen, correct);

  // highlight
  elChoices.querySelectorAll('label.choice').forEach(l=>{
    const idx = parseInt(l.getAttribute('data-index')||'0',10);
    if(correct.includes(idx)) l.classList.add('correct');
    if(chosen.includes(idx) && !correct.includes(idx)) l.classList.add('incorrect');
    (l.querySelector('input')).disabled = true;
  });

  elFeedback.classList.remove('hidden');
  elFeedback.innerHTML = ok
    ? `<div class="ok">Teisingai!</div><div>${current.feedback_short || ''}</div><div style="margin-top:6px">${current.feedback_long || ''}</div>`
    : `<div class="bad">Neteisinga(-s).</div><div>${current.feedback_short || ''}</div><div style="margin-top:6px">${current.feedback_long || ''}</div>`;

  elCheck.disabled = true;
  elNext.classList.remove('hidden');
}

function nextQuestion(){
  const q = pickRandomQuestion();
  if(q){
    renderQuestion(q);
  }else{
    // Visos užduotys baigtos
    elTema.textContent = 'Puiku!';
    elQid.textContent = '✓';
    elKlausimas.textContent = 'Peržiūrėjote visus klausimus. Paspauskite „Perkrauti“, kad pradėtumėte iš naujo.';
    elChoices.innerHTML = '';
    elFeedback.classList.add('hidden');
    elNext.classList.add('hidden');
    elCheck.disabled = true;
  }
}

elCheck.addEventListener('click', checkAnswer);
elNext.addEventListener('click', nextQuestion);
elRestart.addEventListener('click', ()=>{
  seen = new Set();
  elSeen.textContent = '0';
  nextQuestion();
});

// Start
nextQuestion();
</script>
</body>
</html>
